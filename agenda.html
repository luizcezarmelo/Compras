<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agenda Fornecedores</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-blue: #0a6ed1;
            --dark-blue: #085a9e;
            --light-blue: #ebf5fb;
            --sap-gold: #f0ab00;
            --gray-50: #f7f7f7;
            --gray-100: #eeeeee;
            --gray-200: #d5d5d5;
            --gray-300: #cccccc;
            --gray-400: #999999;
            --gray-500: #666666;
            --gray-600: #4d4d4d;
            --gray-700: #333333;
            --gray-800: #1a1a1a;
            --gray-900: #000000;
            --success: #2b7c2b;
            --warning: #e9730c;
            --danger: #bb0000;
            --white: #ffffff;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background: var(--gray-100);
            color: var(--gray-900);
            line-height: 1.6;
        }

        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Header */
        .header {
            background: var(--white);
            border-bottom: 1px solid var(--gray-200);
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--gray-900);
        }

        .header-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }


        .toolbar {
            background: var(--white);
            border-bottom: 1px solid var(--gray-200);
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 12px;
        }

        .toolbar-left {
            display: flex;
            gap: 12px;
            align-items: center;
            flex: 1;
        }

        .toolbar-right {
            display: flex;
            gap: 12px;
        }

        .search-box {
            position: relative;
            flex: 1;
            max-width: 400px;
        }

        .search-box input {
            width: 100%;
            padding: 10px 12px 10px 40px;
            border: 1px solid var(--gray-300);
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.2s;
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(0, 112, 243, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-400);
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }

        .btn-primary {
            background: var(--primary-blue);
            color: white;
        }

        .btn-primary:hover {
            background: var(--dark-blue);
        }

        .btn-secondary {
            background: var(--white);
            color: var(--gray-700);
            border: 1px solid var(--gray-300);
        }

        .btn-secondary:hover {
            background: var(--gray-50);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-icon {
            padding: 10px;
        }


        .table-container {
            flex: 1;
            padding: 0 24px 24px 24px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .table-wrapper {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: 8px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            flex: 1;
        }

        .table-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--gray-50);
        }

        .table-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--gray-900);
        }

        .table-filters {
            display: flex;
            gap: 8px;
        }

        .filter-tag {
            padding: 6px 12px;
            background: var(--white);
            border: 1px solid var(--gray-300);
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .filter-tag:hover {
            border-color: var(--primary-blue);
            color: var(--primary-blue);
        }

        .filter-tag.active {
            background: var(--primary-blue);
            color: white;
            border-color: var(--primary-blue);
        }

        .table-scroll {
            overflow-x: auto;
            overflow-y: auto;
            flex: 1;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        thead {
            background: var(--gray-50);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        th {
            padding: 12px 16px;
            text-align: left;
            font-weight: 600;
            color: var(--gray-700);
            border-bottom: 2px solid var(--gray-200);
            white-space: nowrap;
            cursor: pointer;
            user-select: none;
        }

        th:hover {
            background: var(--gray-100);
        }

        th .sort-icon {
            display: inline-block;
            margin-left: 6px;
            color: var(--gray-400);
            font-size: 12px;
        }

        tbody tr {
            border-bottom: 1px solid var(--gray-200);
            transition: background 0.15s;
        }

        tbody tr:hover {
            background: var(--gray-50);
        }

        td {
            padding: 16px;
            color: var(--gray-700);
        }

        .contact-name {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* NEGRITO NA EMPRESA */
        .company-name-text {
            font-weight: 500;
            color: var(--gray-900);
        }

        .favorite-icon {
            cursor: pointer;
            font-size: 18px;
            transition: all 0.2s;
        }

        .favorite-icon.active {
            color: var(--warning);
        }

        .favorite-icon:not(.active) {
            color: var(--gray-300);
        }

        .favorite-icon:hover {
            transform: scale(1.2);
        }

        .copyable {
            cursor: pointer;
            transition: background 0.2s;
        }

        .copyable:hover {
            background: var(--light-blue);
        }

        .notes-cell {
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .btn-table {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-edit {
            background: var(--gray-100);
            color: var(--gray-700);
        }

        .btn-edit:hover {
            background: var(--gray-200);
        }

        .btn-delete {
            background: #fee2e2;
            color: var(--danger);
        }

        .btn-delete:hover {
            background: #fecaca;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 8px;
            width: 90%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--gray-900);
        }

        .modal-close {
            width: 32px;
            height: 32px;
            border: none;
            background: var(--gray-100);
            border-radius: 4px;
            cursor: pointer;
            font-size: 20px;
            color: var(--gray-600);
            transition: all 0.2s;
        }

        .modal-close:hover {
            background: var(--gray-200);
        }

        .modal-body {
            padding: 24px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-label {
            font-size: 13px;
            font-weight: 500;
            color: var(--gray-700);
            margin-bottom: 6px;
        }

        .form-label .required {
            color: var(--danger);
        }

        .form-input,
        .form-select,
        .form-textarea {
            padding: 10px 12px;
            border: 1px solid var(--gray-300);
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.2s;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(0, 112, 243, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .modal-footer {
            padding: 16px 24px;
            border-top: 1px solid var(--gray-200);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            background: var(--gray-50);
        }

        .empty-state {
            padding: 60px 20px;
            text-align: center;
            color: var(--gray-500);
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.3;
        }

        .empty-state h3 {
            font-size: 18px;
            color: var(--gray-700);
            margin-bottom: 8px;
        }

        /* Pagination */
        .pagination {
            padding: 16px 20px;
            border-top: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--gray-50);
        }

        .pagination-info {
            font-size: 13px;
            color: var(--gray-600);
        }

        .pagination-controls {
            display: flex;
            gap: 8px;
        }

        .page-btn {
            padding: 6px 12px;
            border: 1px solid var(--gray-300);
            background: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }

        .page-btn:hover:not(:disabled) {
            background: var(--gray-50);
            border-color: var(--primary-blue);
        }

        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .page-btn.active {
            background: var(--primary-blue);
            color: white;
            border-color: var(--primary-blue);
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }

        @media (max-width: 1024px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .toolbar {
                flex-direction: column;
                align-items: stretch;
            }

            .toolbar-left,
            .toolbar-right {
                width: 100%;
            }

            .search-box {
                max-width: 100%;
            }

            .table-scroll {
                overflow-x: auto;
            }

            table {
                min-width: 900px;
            }

            .notes-cell {
                max-width: 150px;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                width: 95%;
                margin: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <h1 class="header-title">Sistema de Gest√£o de Contatos</h1>
            </header>

            <!-- Toolbar -->
            <div class="toolbar">
                <div class="toolbar-left">
                    <div class="search-box">
                        <span class="search-icon">üîç</span>
                        <input type="text" id="searchInput" placeholder="Buscar por nome, telefone, email ou empresa...">
                    </div>
                </div>
                <div class="toolbar-right">
                    <button class="btn btn-secondary" onclick="exportData()">
                        üì• Exportar
                    </button>
                    <button class="btn btn-secondary" onclick="importData()">
                        üì§ Importar
                    </button>
                    <button class="btn btn-primary" onclick="openModal()">
                        ‚ûï Novo Contato
                    </button>
                </div>
            </div>

            <!-- Table -->
            <div class="table-container">
                <div class="table-wrapper">
                    <div class="table-header">
                        <div class="table-title">Lista de Contatos</div>
                        <div class="table-filters">
                            <span class="filter-tag active" data-filter="all">Todos</span>
                            <span class="filter-tag" data-filter="favorites">‚≠ê Favoritos</span>
                        </div>
                    </div>
                    <div class="table-scroll">
                        <table id="contactsTable">
                            <thead>
                                <tr>
                                    <th onclick="sortTable('favorite')">‚≠ê</th>
                                    <th onclick="sortTable('company')">Empresa <span class="sort-icon">‚áÖ</span></th>
                                    <th onclick="sortTable('name')">Contato <span class="sort-icon">‚áÖ</span></th>
                                    <th onclick="sortTable('phone')">Telefone <span class="sort-icon">‚áÖ</span></th>
                                    <th onclick="sortTable('email')">Email <span class="sort-icon">‚áÖ</span></th>
                                    <th onclick="sortTable('notes')">Observa√ß√µes <span class="sort-icon">‚áÖ</span></th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="contactsTableBody">
                                <tr>
                                    <td colspan="7">
                                        <div class="empty-state">
                                            <div class="empty-state-icon">üìã</div>
                                            <h3>Nenhum contato encontrado</h3>
                                            <p>Clique em "Novo Contato" para come√ßar</p>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="pagination">
                        <div class="pagination-info" id="paginationInfo">Mostrando 0 de 0 registros</div>
                        <div class="pagination-controls" id="paginationControls"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal -->
    <div class="modal" id="contactModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Novo Contato</h2>
                <button class="modal-close" onclick="closeModal()">√ó</button>
            </div>
            <form id="contactForm">
                <div class="modal-body">
                    <div class="form-grid">
                        <div class="form-group full-width">
                            <label class="form-label">Empresa <span class="required">*</span></label>
                            <input type="text" class="form-input" id="company" required>
                        </div>
                        <div class="form-group full-width">
                            <label class="form-label">Contato <span class="required">*</span></label>
                            <input type="text" class="form-input" id="name" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Telefone <span class="required">*</span></label>
                            <input type="tel" class="form-input" id="phone" placeholder="(00) 00000-0000" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-input" id="email" placeholder="exemplo@empresa.com">
                        </div>
                        <div class="form-group full-width">
                            <label class="form-label">Observa√ß√µes</label>
                            <textarea class="form-textarea" id="notes" placeholder="Informa√ß√µes adicionais sobre o contato..."></textarea>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-success">üíæ Salvar Contato</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue, remove, push } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC87U4DwYdrbHpok8r1ky893ruU-o6OXD8",
            authDomain: "trabalho-e99e3.firebaseapp.com",
            databaseURL: "https://trabalho-e99e3-default-rtdb.firebaseio.com",
            projectId: "trabalho-e99e3",
            storageBucket: "trabalho-e99e3.firebasestorage.app",
            messagingSenderId: "272958172515",
            appId: "1:272958172515:web:0b93d2681101251ed8b756",
            measurementId: "G-27FYQZX7HH"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        let contacts = [];
        let editingId = null;
        let currentFilter = 'all';
        let sortColumn = 'company';
        let sortDirection = 'asc';
        let currentPage = 1;
        let itemsPerPage = 10;
        let searchTimeout = null;

        // Inicializar
        function init() {
            loadContactsFromFirebase();
            setupEventListeners();
        }

        // Carregar contatos do Firebase
        function loadContactsFromFirebase() {
            const contactsRef = ref(database, 'contacts');
            onValue(contactsRef, (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    contacts = Object.keys(data).map(key => ({
                        id: key,
                        name: data[key].name || '',
                        company: data[key].company || '',
                        phone: data[key].phone || '',
                        email: data[key].email || '',
                        notes: data[key].notes || '',
                        favorite: data[key].favorite || false,
                        createdAt: data[key].createdAt || '',
                        updatedAt: data[key].updatedAt || ''
                    }));
                } else {
                    contacts = [];
                }
                renderTable();
            });
        }

        // Salvar contato no Firebase
        function saveToFirebase(contact) {
            const contactToSave = {
                name: contact.name || '',
                company: contact.company || '',
                phone: contact.phone || '',
                email: contact.email || '',
                notes: contact.notes || '',
                favorite: contact.favorite || false,
                createdAt: contact.createdAt || new Date().toISOString(),
                updatedAt: contact.updatedAt || new Date().toISOString()
            };
            
            const contactRef = ref(database, 'contacts/' + contact.id);
            set(contactRef, contactToSave);
        }

        // Deletar contato do Firebase
        function deleteFromFirebase(id) {
            const contactRef = ref(database, 'contacts/' + id);
            remove(contactRef);
        }

        // Configurar event listeners
        function setupEventListeners() {
            const searchInput = document.getElementById('searchInput');
            
            // Pesquisa com debounce
            searchInput.addEventListener('input', function(e) {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    currentPage = 1;
                    renderTable();
                }, 300);
            });
            
            document.querySelectorAll('.filter-tag').forEach(tag => {
                tag.addEventListener('click', function() {
                    document.querySelectorAll('.filter-tag').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    currentFilter = this.dataset.filter;
                    currentPage = 1;
                    renderTable();
                });
            });

            // M√°scara de telefone
            const phoneInput = document.getElementById('phone');
            phoneInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length <= 11) {
                    value = value.replace(/^(\d{2})(\d)/g, '($1) $2');
                    value = value.replace(/(\d)(\d{4})$/, '$1-$2');
                }
                e.target.value = value;
            });

            // Enter e Tab em todos os inputs do formul√°rio
            const formFields = ['company', 'name', 'phone', 'email', 'notes'];
            formFields.forEach((fieldId, index) => {
                const field = document.getElementById(fieldId);
                
                field.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        
                        // Se for o √∫ltimo campo (notes), focar no bot√£o salvar
                        if (index === formFields.length - 1) {
                            const saveBtn = document.querySelector('.modal-footer .btn-success');
                            if (saveBtn) saveBtn.focus();
                        } else {
                            // Ir para o pr√≥ximo campo
                            const nextField = document.getElementById(formFields[index + 1]);
                            if (nextField) nextField.focus();
                        }
                    } else if (e.key === 'Tab' && index === formFields.length - 1 && !e.shiftKey) {
                        // Tab no √∫ltimo campo vai para o bot√£o
                        e.preventDefault();
                        const saveBtn = document.querySelector('.modal-footer .btn-success');
                        if (saveBtn) saveBtn.focus();
                    }
                });
            });

            // Fechar modal ao clicar fora
            document.getElementById('contactModal').addEventListener('click', function(e) {
                if (e.target === this) closeModal();
            });

            // Submeter formul√°rio
            document.getElementById('contactForm').addEventListener('submit', saveContact);
        }

        // FUN√á√ÉO DE PESQUISA COMPLETAMENTE REFEITA
        function searchContacts(searchTerm) {
            if (!searchTerm || searchTerm.length < 3) {
                return contacts;
            }
            
            const lowerSearchTerm = searchTerm.toLowerCase();
            
            return contacts.filter(contact => {
                // Verificar empresa
                if (contact.company && contact.company.toLowerCase().includes(lowerSearchTerm)) {
                    return true;
                }
                
                // Verificar nome
                if (contact.name && contact.name.toLowerCase().includes(lowerSearchTerm)) {
                    return true;
                }
                
                // Verificar email
                if (contact.email && contact.email.toLowerCase().includes(lowerSearchTerm)) {
                    return true;
                }
                
                // Verificar telefone (remover formata√ß√£o)
                if (contact.phone) {
                    const phoneClean = contact.phone.replace(/\D/g, '');
                    const searchClean = lowerSearchTerm.replace(/\D/g, '');
                    if (searchClean && phoneClean.includes(searchClean)) {
                        return true;
                    }
                }
                
                // Verificar observa√ß√µes
                if (contact.notes && contact.notes.toLowerCase().includes(lowerSearchTerm)) {
                    return true;
                }
                
                return false;
            });
        }

        // Filtrar contatos - FUN√á√ÉO SIMPLIFICADA
        function getFilteredContacts() {
            const searchInput = document.getElementById('searchInput');
            const searchTerm = searchInput.value.trim();
            
            // Se menos de 3 caracteres, retorna vazio ou todos dependendo do comprimento
            if (searchTerm.length > 0 && searchTerm.length < 3) {
                return []; // Retorna array vazio para mostrar "Digite pelo menos 3 caracteres"
            }
            
            let filtered = contacts;
            
            // Aplicar busca se tiver 3+ caracteres
            if (searchTerm.length >= 3) {
                filtered = searchContacts(searchTerm);
            }
            
            // Aplicar filtro de favoritos
            if (currentFilter === 'favorites') {
                filtered = filtered.filter(contact => contact.favorite);
            }
            
            return filtered;
        }

        // Renderizar tabela
        function renderTable() {
            let filtered = getFilteredContacts();
            
            // Ordenar
            filtered.sort((a, b) => {
                let aVal = a[sortColumn] || '';
                let bVal = b[sortColumn] || '';
                
                if (sortColumn === 'favorite') {
                    aVal = a.favorite ? 1 : 0;
                    bVal = b.favorite ? 1 : 0;
                }
                
                if (typeof aVal === 'string') {
                    aVal = aVal.toLowerCase();
                    bVal = bVal.toLowerCase();
                }
                
                if (aVal < bVal) return sortDirection === 'asc' ? -1 : 1;
                if (aVal > bVal) return sortDirection === 'asc' ? 1 : -1;
                return 0;
            });

            // Pagina√ß√£o
            const totalItems = filtered.length;
            const totalPages = Math.max(1, Math.ceil(totalItems / itemsPerPage));
            
            // Ajustar p√°gina atual se estiver fora do range
            if (currentPage > totalPages) {
                currentPage = totalPages;
            }
            if (currentPage < 1) {
                currentPage = 1;
            }
            
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageItems = filtered.slice(startIndex, endIndex);

            const tbody = document.getElementById('contactsTableBody');
            
            if (pageItems.length === 0) {
                const searchTerm = document.getElementById('searchInput').value.trim();
                let message = 'Nenhum contato encontrado';
                let submessage = 'Tente ajustar os filtros ou adicionar um novo contato';
                
                if (searchTerm.length > 0 && searchTerm.length < 3) {
                    message = 'Digite pelo menos 3 caracteres para pesquisar';
                    submessage = '';
                }
                
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7">
                            <div class="empty-state">
                                <div class="empty-state-icon">üìã</div>
                                <h3>${message}</h3>
                                ${submessage ? `<p>${submessage}</p>` : ''}
                            </div>
                        </td>
                    </tr>
                `;
            } else {
                // Limpar tbody antes de adicionar novos elementos
                tbody.innerHTML = '';
                
                pageItems.forEach(contact => {
                    const contactId = contact.id;
                    const company = escapeHtml(contact.company || '-');
                    const name = escapeHtml(contact.name || '-');
                    const phone = escapeHtml(contact.phone || '-');
                    const email = escapeHtml(contact.email || '-');
                    const notes = escapeHtml(contact.notes || '-');
                    const favoriteClass = contact.favorite ? 'active' : '';
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <span class="favorite-icon ${favoriteClass}" 
                                  data-id="${contactId}">‚òÖ</span>
                        </td>
                        <td class="copyable" title="Clique para copiar">
                            <span class="company-name-text">${company}</span>
                        </td>
                        <td class="copyable" title="Clique para copiar">
                            <div class="contact-name">
                                <span>${name}</span>
                            </div>
                        </td>
                        <td class="copyable" title="Clique para copiar">${phone}</td>
                        <td class="copyable" title="Clique para copiar">${email}</td>
                        <td class="copyable notes-cell" title="Clique para copiar">${notes}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn-table btn-edit" data-id="${contactId}">‚úèÔ∏è Editar</button>
                                <button class="btn-table btn-delete" data-id="${contactId}">üóëÔ∏è Excluir</button>
                            </div>
                        </td>
                    `;
                    
                    // Adicionar event listeners diretamente
                    const favoriteIcon = row.querySelector('.favorite-icon');
                    favoriteIcon.addEventListener('click', function() {
                        window.toggleFavorite(this.getAttribute('data-id'));
                    });
                    
                    const editBtn = row.querySelector('.btn-edit');
                    editBtn.addEventListener('click', function() {
                        window.editContact(this.getAttribute('data-id'));
                    });
                    
                    const deleteBtn = row.querySelector('.btn-delete');
                    deleteBtn.addEventListener('click', function() {
                        window.deleteContact(this.getAttribute('data-id'));
                    });
                    
                    // Adicionar fun√ß√£o de copiar em c√©lulas copyable
                    row.querySelectorAll('.copyable').forEach(cell => {
                        cell.addEventListener('click', function() {
                            let textToCopy = '';
                            
                            // Para a c√©lula da empresa, pegar o texto com classe company-name-text
                            if (cell.querySelector('.company-name-text')) {
                                const companySpan = cell.querySelector('.company-name-text');
                                textToCopy = companySpan ? companySpan.textContent.trim() : '';
                            } 
                            // Para outras c√©lulas
                            else {
                                textToCopy = cell.textContent.trim();
                            }
                            
                            // Remover qualquer "-" vazio
                            if (textToCopy && textToCopy !== '-') {
                                copyToClipboard(textToCopy);
                            }
                        });
                    });
                    
                    tbody.appendChild(row);
                });
            }

            // Atualizar pagina√ß√£o
            updatePagination(totalItems, totalPages);
        }

        // Escapar HTML para prevenir XSS
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Atualizar pagina√ß√£o
        function updatePagination(totalItems, totalPages) {
            const info = document.getElementById('paginationInfo');
            const controls = document.getElementById('paginationControls');
            
            const startItem = totalItems === 0 ? 0 : (currentPage - 1) * itemsPerPage + 1;
            const endItem = Math.min(currentPage * itemsPerPage, totalItems);
            
            info.textContent = `Mostrando ${startItem}-${endItem} de ${totalItems} registros`;
            
            if (totalPages <= 1) {
                controls.innerHTML = '';
                return;
            }

            let html = `
                <button class="page-btn" onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>
                    ‚Üê Anterior
                </button>
            `;

            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - 1 && i <= currentPage + 1)) {
                    html += `
                        <button class="page-btn ${i === currentPage ? 'active' : ''}" 
                                onclick="changePage(${i})">${i}</button>
                    `;
                } else if (i === currentPage - 2 || i === currentPage + 2) {
                    html += `<span style="padding: 0 8px;">...</span>`;
                }
            }

            html += `
                <button class="page-btn" onclick="changePage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>
                    Pr√≥ximo ‚Üí
                </button>
            `;

            controls.innerHTML = html;
        }

        // Mudar p√°gina
        function changePage(page) {
            const totalPages = Math.ceil(getFilteredContacts().length / itemsPerPage);
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                renderTable();
            }
        }

        // Ordenar tabela
        function sortTable(column) {
            if (sortColumn === column) {
                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                sortColumn = column;
                sortDirection = 'asc';
            }
            renderTable();
        }

        // Abrir modal
        function openModal(contact = null) {
            const modal = document.getElementById('contactModal');
            const form = document.getElementById('contactForm');
            const title = document.getElementById('modalTitle');

            if (contact) {
                title.textContent = 'Editar Contato';
                document.getElementById('company').value = contact.company || '';
                document.getElementById('name').value = contact.name || '';
                document.getElementById('phone').value = contact.phone || '';
                document.getElementById('email').value = contact.email || '';
                document.getElementById('notes').value = contact.notes || '';
                editingId = contact.id;
            } else {
                title.textContent = 'Novo Contato';
                form.reset();
                editingId = null;
            }

            modal.classList.add('active');
            document.getElementById('company').focus();
        }

        // Fechar modal
        function closeModal() {
            document.getElementById('contactModal').classList.remove('active');
            document.getElementById('contactForm').reset();
            editingId = null;
        }

        // Salvar contato
        function saveContact(e) {
            e.preventDefault();

            const contact = {
                name: document.getElementById('name').value.trim(),
                company: document.getElementById('company').value.trim(),
                phone: document.getElementById('phone').value.trim(),
                email: document.getElementById('email').value.trim(),
                notes: document.getElementById('notes').value.trim(),
                favorite: false
            };

            if (editingId !== null) {
                const existingContact = contacts.find(c => c.id === editingId);
                contact.id = editingId;
                contact.favorite = existingContact ? existingContact.favorite : false;
                contact.createdAt = existingContact ? existingContact.createdAt : new Date().toISOString();
                contact.updatedAt = new Date().toISOString();
            } else {
                // Gerar ID √∫nico usando push().key
                const newContactRef = push(ref(database, 'contacts'));
                contact.id = newContactRef.key;
                contact.createdAt = new Date().toISOString();
                contact.updatedAt = new Date().toISOString();
            }

            saveToFirebase(contact);
            closeModal();
        }

        // Copiar para √°rea de transfer√™ncia
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                // Feedback visual
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: var(--success);
                    color: white;
                    padding: 12px 20px;
                    border-radius: 6px;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                    z-index: 10000;
                    font-size: 14px;
                    animation: slideIn 0.3s;
                `;
                notification.textContent = '‚úì Copiado: ' + text;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.animation = 'slideOut 0.3s';
                    setTimeout(() => notification.remove(), 300);
                }, 2000);
            }).catch(err => {
                console.error('Erro ao copiar:', err);
                alert('N√£o foi poss√≠vel copiar. Tente novamente.');
            });
        }

        // Editar contato
        function editContact(id) {
            const contact = contacts.find(c => c.id === id);
            if (contact) {
                openModal(contact);
            }
        }

        // Excluir contato
        function deleteContact(id) {
            if (confirm('Tem certeza que deseja excluir este contato?')) {
                deleteFromFirebase(id);
            }
        }

        // Toggle favorito
        function toggleFavorite(id) {
            const contact = contacts.find(c => c.id === id);
            if (contact) {
                contact.favorite = !contact.favorite;
                contact.updatedAt = new Date().toISOString();
                saveToFirebase(contact);
            }
        }

        // Exportar dados
        function exportData() {
            const dataStr = JSON.stringify(contacts, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `contatos_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }

        // Importar dados
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const importedContacts = JSON.parse(event.target.result);
                        if (confirm(`Deseja importar ${importedContacts.length} contatos? Isso ir√° adicionar aos dados existentes.`)) {
                            importedContacts.forEach(contact => {
                                const newContactRef = push(ref(database, 'contacts'));
                                contact.id = newContactRef.key;
                                contact.createdAt = contact.createdAt || new Date().toISOString();
                                contact.updatedAt = new Date().toISOString();
                                saveToFirebase(contact);
                            });
                            currentPage = 1;
                            alert('Contatos importados com sucesso!');
                        }
                    } catch (err) {
                        alert('Erro ao importar arquivo. Verifique se √© um arquivo JSON v√°lido.');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // Tornar fun√ß√µes globais
        window.openModal = openModal;
        window.closeModal = closeModal;
        window.editContact = editContact;
        window.deleteContact = deleteContact;
        window.toggleFavorite = toggleFavorite;
        window.sortTable = sortTable;
        window.changePage = changePage;
        window.exportData = exportData;
        window.importData = importData;

        // Inicializar aplica√ß√£o
        init();
    </script>
</body>
</html>
